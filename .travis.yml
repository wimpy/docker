services:
  - docker

env:
  global:
    - REPO=fiunchinho/wimpy
    - AWS_DEFAULT_REGION=eu-west-1
    - secure: "RQcBWuHsqdrP28GkhUQSg6hhQc9015ir0LMpJLENapWDLNBHPexh7rX70ghxmmxvMr3TcVInLsANwuNpQXT8NSoNzYkDvik6rWy/GCnsUEx1ziefTuvNGydOJyo3yJyaIrJkPtILuHC9k6Aj5MDVrjEausjf4iiADxQlBt2BJXpt5kM/29YjkJB4l9esuNmY+Rn/IURLut3Z7qDN43Udc5wH94VkM1xg3nDMfAJlMzKgFhWR9RwrOsRX835+SLkdNy8LvalzJC1GwBwfAqJNkmgs+xQ62Ms9P3dbnBc5skSKr+3V9SWj1Eki//sGfUM6sVJ0KlC4piNJaSQzTkRgeUEI1ztWp+DP4baJI0c0w7W7GnHADNToEmqd3lgcu7T7lq+A9LHzXGYimmqda8QWCvjjQ2UvAuRN49zQIbvFA8d2HowmnzeDgcKjpEV7SxVtWIiKMLBp4ubrGYwjwxkaQYlldsfZKbhlzpmMDwdyMrlOQU4yAnEbDoEQe84oqEOzIiI53ZesjVXl6WnzsiYNgaOXuwfHt3Dfl8lz1IZ+L6YUo7b9UOHVmKlZjzQ8S5dii/f1bhdaGymP50WAKUPY8zYp9WQgettI8Alxz9OJ1hmCffGnz+IBp54tNoDJDxiwvDY/ql2F+yERPxc6Re/B5aDWF80Ebl4TKZJm+Xw5YJA=" # DOCKER_EMAIL
    - secure: "ne3chbJR8CQ94PEFHJnV3PK8pWJP/vX8qUIwYCCAsjRWFr5sz8qRYvuQzYcBYaf1hCFLXEQpqTsLiDBcvXGdYW76G1PS9hwA3wKO1mCGmJdaJdDtN4AY7XJpEoEI1iKN9Pnwm9Ye6Ld2xnpbyXktj6MmZeWSx8lBVHSOi9gwBns9B2tDOXL8XASP4W8igVY7idlhKgP+t6ewZYJQXcYch0WWUqzdVP5uL2o8bZdDD0ALq9IqMsHq8fYRgnCGJiyZQjGqA1s0AkQ57P3c3Xq1GfXEzqMgmTGUPGlK/yOyQNqkJn4xaPpWMSnqoroi1YW/i818LaDwZQl/Z+Wu5CgkmAZh5M1PYUgzUN3g6hqAI7DAKKNu2pt5j8eEzNpg3JeNzMy37AQS3EFMik3JOYTAAt1lQYMPlufgINdFIuTR+qvuGVlvA/oxUsAuWoq1V4mXYoZws/6a60jbJHK75tXM/yW4PaAAirwATHU15QdSzaHMwim5b3xOHQzBXACJ6AYlQfABvFc6OjmIoZMFMpF2rTpG6pus2EGmmjiL7Ugkl+HYF6r/44FMhWuvUDY2sWJpgTJyrA8+WT/dezOUWDV0mqtQfSf3VJI113VJoanzd2cp5LlF42wu6BgTGI+UIb5ksXNApF47CrNIL5dgp3VsLAapnhGLOmWb7WpGGTIngB8=" # DOCKER_USER
    - secure: "A6YixmZWcH7MltKll1YP9RSEbcEyE4eBSYiW3xO8VGMWxgYQAcF3azNMchSbfkbN4pA4V+K0dnevZwJXZRLpAb9+OCMpiBm8QSKVdBAW97TVHfwfPWC6oeNNYRcxGkkMvH3p3cj9z+96fRs5fuK1a7D7QXHcBSITAlO+8l8lfEIaZzz3TmvUzdxJIzejIT32E1UJqeFGamZk518phAOKdb0JgUFDqhBOgW5j0sdnSbhvwU6C0tJWRnbE8tvvrmu5vE3BFsLoG3jFLBf958o6nkrBK4Rx1ApH0e4V/F9zVCA4zCDwFLluOOSq8UaEuKcWzoHQxL3VcWao12P9uL/pjNkGl91ZiuWuI2iO09FEkmYLJbwAm//OofIGLgKGoUCBz4i7fc38WGHKpUR6LxWq2AgbL3gp8NjvPw8jI5oKkGoBInpMyUCCGn1fk0VknL70N1NBNTPSQwsNZFTQWSStPYPdbOHN1uzow183uBYxBQfXO1fUH649iHMr/lt3rocWwvAP/+WgzMNLPxVlnjQI/Ram51McbQ8Gz//uBGPd55etvXneYRXS425GNRWVKealboM6+yMm6JdYzuCH5xv0HYflbBzAiRYiGY1fKNkeNsYKSO5pbaxPrbmvlk2r5LDfiQ1RArb3Er83IoZ9Xvrl5ojtzBPKoTgL85rsDzUkrCk=" # DOCKER_PASS
    - secure: "GwpCHGQuLRZWp8Ng/TpXXfmCoc35t6qnC8TxaVvw7ikKZBrKD0DZ52KIzUhxyu/bAbcM455OZXkcWA7Ns530rdyV8Qc27YJczrHDnHMtB+mAt++aZSRobRYkcWKnrwlLPQue3uARVZJIFTvoeocLz+G4TUJw4+yj73txLaQaD4vbPYUeR9vpyCHxmLPe25sfwuDIbkTiLNTfTsluYTa3HZ8PQ+RixbsxefQQla0YXs6h63PczhlHnIhtavlWfjxR7SQIDpMZuvAc5Sx1wHfeBwuTE+NuTxjg2jbyuf951DCH4v2ossKUBx+Arg7BdWGPzX+OjzSQ3uvmOJcm9tP+ATnarooSKq8nrGS+Kw1lg6mCvzAXL2t6kjMQwTusWQzwchttZtA7F9akyKwZGTGyuWqjoKQoVkSWq849dXpV+aQ8uI0iWDeGIx+sIaolSxdks76QiL6AEKAGA8d/xEgbLkgwU8z9Ok0iJpuDSAi10Pg2cnenrBLqoWak0ZC1jJrNSdhSZ4jKWY6MIAfdAPfKQs+8yaJW9uH34Ca6vak2i5WyjqxhowOYOn22BZaJam+ErCIZ8I5+YCn9tUUqhUYSBYGae5O7kCCWNl/3971gatwz+Y8lj4uk7bP6CZAaHVPpF2sFsUccamARrL7a9TZB1QsWeSGHPFwyv3aQGoXgrGE=" # AWS_ACCESS_KEY_ID
    - secure: "307i5OCd5Nx/8xRgR1I6ZYbci7sHOHzOXq2KZl3AMATZJe39ItHnVOPSlbApMYt1s3nBDHYY2FPYsxrzr7RQw7tUTKgE/ssdf33TOYI8yVEzre4RBRFAJe8h1OCSmMSDuKDvUgZocAox2hRu/652+uu9FCLmJwuCq0FoKNPY8SZJihixWKW/Uwf1kqZChTwIN2m8G0ZoTvCQniUqFDTkrXsesBETvOsnKGE8QLuElGg/q62S/kxcYUXn/lusoCvBzp+rLz/shBb7RUo5e5uKQpMahHjjTp+f6UfjhygUjRerQU4efvvAhzcX9Cuh/SG0eGqJkO8IohbuhzWz1urBaQOqcvGdHxhpAX32ggazZGBnfPboMm1N+tOd1hrM5HQ8h60DJBjgR1b9Xfh9SkKvi3Gt0oGNnyH2nhKsIz2l3DeDkxBRJ3KhlAAJ7gPchFUDyzRM/8Em9wQ6xjXqdyX9B6wrinXkqkAwL8dtcmXskmaKNSWfe/JSL0vknS8piUpsCm4vg+wJSPL3bdM8Czzy+CDFnIFEn7l2yuMHU9xPssQYLBpPSPsDb63AHtqrtqxiaUTYc/43IpK8AQiVFLWxgpnOylq8ZHLd1cxFKG9wBwrYPCSLKHJ9mP3Ur/FS6wOKfp2OjT1H9u3wt7v63SpOsNmffYSUklER/gIvhdKB6Cc=" # AWS_SECRET_ACCESS_KEY

before_install:
  - sudo apt-get update
  - sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-engine
  - sudo pip install awscli
  - docker pull fiunchinho/wimpy

jobs:
  include:
    - stage: Build
      script: ./build.sh
    - stage: Test
      script: ./test.sh
    - stage: Clean
      script: ./clean.sh
    - stage: Publish
      script:
        - docker login -e "${DOCKER_EMAIL}" -u "${DOCKER_USER}" -p "${DOCKER_PASS}"
        - docker push ${REPO}
